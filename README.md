## Orizon Coordinator

This project is a Spring Boot application that provides a centralized configuration for Kafka producers and consumers.

---

### Modules

- **broker-config-data**: Contains the data classes for Kafka configuration.
- **broker-consumer**: Contains the Kafka consumer implementation.
- **broker-producer**: Contains the Kafka producer implementation.

---

### Configuration

The configuration is managed through `application.yml` files and is loaded into the following classes:

#### Common Kafka Configuration (`kafka.common`)

| Property                  | Description                                       |
| ------------------------- | ------------------------------------------------- |
| `bootstrap-servers`       | Comma-separated list of Kafka broker addresses.   |
| `schema-registry-url-key` | The configuration key for the schema registry URL.|
| `schema-registry-url`     | The URL of the Confluent Schema Registry.         |

#### Kafka Producer Configuration (`kafka.producer`)

| Property                 | Description                                                                 |
| ------------------------ | --------------------------------------------------------------------------- |
| `compression-type`       | The compression type for all data generated by the producer.                |
| `batch-size`             | The producer will attempt to batch records together into fewer requests.    |
| `batch-size-boost-factor`| A factor to multiply the batch size by.                                     |
| `linger-ms`              | The producer groups together any records that arrive in between request transmissions into a single batched request. |
| `request-timeout-ms`     | The configuration controls the maximum amount of time the server will wait for acknowledgments from followers to meet the acknowledgment requirements the producer has specified. |
| `retry-count`            | Setting a value greater than zero will cause the client to resend any record whose send fails with a potentially transient error. |

#### Kafka Consumer Configuration (`kafka.consumer`)

| Property                             | Description                                                                                                                                                                 |
| ------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `auto-offset-reset`                  | What to do when there is no initial offset in Kafka or if the current offset does not exist any more on the server.                                                          |
| `batch-listener`                     | Whether to use a batch listener.                                                                                                                                            |
| `auto-startup`                       | Whether the container should start automatically.                                                                                                                           |
| `allow-auto-create-topics`           | Allow automatic topic creation on the broker when subscribing to or assigning a topic.                                                                                      |
| `session-timeout-ms`                 | The timeout used to detect client failures when using Kafka's group management facility.                                                                                    |
| `heartbeat-interval-ms`              | The expected time between heartbeats to the consumer coordinator when using Kafka's group management facilities.                                                              |
| `concurrency-level`                  | The number of concurrent `MessageListenerContainer`s to create.                                                                                                             |
| `max-poll-interval-ms`               | The maximum delay between invocations of poll() when using group management.                                                                                                |
| `poll-timeout-ms`                    | The time, in milliseconds, to block waiting for message(s) from Kafka.                                                                                                      |
| `max-poll-records`                   | The maximum number of records returned in a single call to poll().                                                                                                          |
| `max-partition-fetch-bytes-default`  | The maximum amount of data per-partition the server will return.                                                                                                            |
| `max-partition-fetch-bytes-boost-factor` | A factor to multiply the `max-partition-fetch-bytes-default` by.                                                                                                          |

---

### Topic-Specific Configuration

In addition to the global configurations, you can specify properties for each topic.

#### Producer Topic Properties

- `key.serializer`: Serializer class for key that implements the `org.apache.kafka.common.serialization.Serializer` interface.
- `value.serializer`: Serializer class for value that implements the `org.apache.kafka.common.serialization.Serializer` interface.
- `acks`: The number of acknowledgments the producer requires the leader to have received before considering a request complete.

#### Consumer Topic Properties

- `key.deserializer`: Deserializer class for key that implements the `org.apache.kafka.common.serialization.Deserializer` interface.
- `value.deserializer`: Deserializer class for value that implements the `org.apache.kafka.common.serialization.Deserializer` interface.
- `enable.auto.commit`: If true the consumer's offset will be periodically committed in the background.
- `group.id`: A unique string that identifies the consumer group this consumer belongs to.
- `specific.avro.reader.key`: The configuration key for the specific Avro reader.
- `specific.avro.reader`: The specific Avro reader.

---

### Example `application.yml`

```yaml
kafka:

  common:
    bootstrap-servers: "localhost:9092"
    schema-registry-url-key: "schema.registry.url"
    schema-registry-url: "http://localhost:8081"

  producer:
    compression-type: "snappy"
    batch-size: 16384
    batch-size-boost-factor: 1
    linger-ms: 1
    request-timeout-ms: 30000
    retry-count: 3

  consumer:
    auto-offset-reset: "earliest"
    batch-listener: false
    auto-startup: true
    allow-auto-create-topics: true
    session-timeout-ms: 10000
    heartbeat-interval-ms: 3000
    concurrency-level: 1
    max-poll-interval-ms: 300000
    poll-timeout-ms: 1000
    max-poll-records: 500
    max-partition-fetch-bytes-default: 1048576
    max-partition-fetch-bytes-boost-factor: 1

  topics:
    num-of-partitions: 3
    replication-factor: 5
    producer-defaults:
      key-serializer: "org.apache.kafka.common.serialization.StringSerializer"
      value-serializer: "io.confluent.kafka.serializers.KafkaAvroSerializer"
      acks: "all"
      additional-props:
        prop-name: "prop-value"
    consumer-defaults:
      key-deserializer: "org.apache.kafka.common.serialization.StringDeserializer"
      value-deserializer: "io.confluent.kafka.serializers.KafkaAvroDeserializer"
      specific-avro-reader: "reader"
      specific-avro-reader-key: "reader-key"
      enable-auto-commit: true
      group-id: "my-specific-group-for-topic"
      additional-props:
        prop-name: "prop-value"

    topic-configs:
      my-topic-name:
        num-of-partitions: 12 #if not set, default will be used
        replication-factor: 23 #if not set, default will be used
        producer:
          # Override defaults if needed
          name: "producerName"
          key-serializer: "org.apache.kafka.common.serialization.StringSerializer"
          value-serializer: "io.confluent.kafka.serializers.KafkaAvroSerializer"
          acks: "1"
          additional-props:
            prop-name: "prop-value"
        consumer:
          # Override defaults if needed
          consumer-factory: "myTopicNameConsumerFactory"
          key-deserializer: "org.apache.kafka.common.serialization.StringDeserializer"
          value-deserializer: "io.confluent.kafka.serializers.KafkaAvroDeserializer"
          specific-avro-reader: "reader"
          specific-avro-reader-key: "reader-key"
          enable-auto-commit: true
          group-id: "my-specific-group-for-topic"
          additional-props:
            prop-name: "prop-value"
```